"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}
/**
 * @author       Juan Jose Capellan <soycape@hotmail.com>
 * @license      {@link https://opensource.org/licenses/MIT|MIT License}
 */var LsPointsGenerator=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.length,r=void 0===n?30:n,a=t.angle,i=void 0===a?15:a,s=t.iterations,o=void 0===s?2:s,h=t.branchFactor,c=void 0===h?1:h,l=t.maxPoints,u=void 0===l?3e4:l;_classCallCheck(this,e),this.initHelpers(),this.config={},this.config.length=r,this.config.angle=i,this.config.iterations=o,this.config.branchFactor=c,this.config.maxPoints=u}return _createClass(e,[{key:"makePoints",value:function(e,t){var n=Math.PI/2,r=this.helpers.maxIterations(t,this.config.maxPoints),a=this.config,i=this.helpers.validateLength(a.length),s=this.helpers.validateAngle(a.angle);this.config.iterations=this.config.iterations>r?r:this.config.iterations;for(var o=this.helpers.makeString(e,t,a.iterations),h=Array.isArray(i),c=Array.isArray(s),l=this.helpers.initState(n),u=this.helpers.initPointsMap(n),g=0,p=0,v={minX:0,maxX:0,minY:0,maxY:0},f={},m=0;m<o.length;m++){var d=o.charAt(m);if("F"!=d&&"X"!=d)switch(d){case"-":p=this.helpers.getValueFromRange(s,c),l.current.angle+=p;break;case"+":p=this.helpers.getValueFromRange(s,c),l.current.angle-=p;break;case"[":l.level++,this.helpers.saveCurrent(l);break;case"]":l.level--,this.helpers.restoreCurrent(l)}else g=this.helpers.getValueFromRange(i,h)*Math.pow(a.branchFactor,l.current.level),this.helpers.move(l,g),this.helpers.savePoint(l,u),this.helpers.updateBounds(l.current,v)}return f.map=u,f.width=v.maxX-v.minX,f.height=v.maxY-v.minY,f.minX=v.minX,f.minY=v.minY,this.helpers.toPositive(f)}},{key:"initHelpers",value:function(){this.helpers={initState:function(e){var t={};return t.current={x:0,y:0,angle:e,level:0,index:0},t.stack=[{x:0,y:0,angle:e,level:0,index:0}],t.level=0,t.index=0,t.parent=0,t},initPointsMap:function(e){var t=new Map;return t.set(0,{x:0,y:0,angle:e,level:0,parent:-1,index:0}),t},makeString:function(e,t,n){var r=e.toUpperCase();t=t.toUpperCase();for(var a=0;a<n;a++)r=r.replace(/X/g,t);return r},copyObject:function(e){return Object.assign({},e)},updateBounds:function(e,t){e.x<t.minX&&(t.minX=e.x),e.x>t.maxX&&(t.maxX=e.x),e.y<t.minY&&(t.minY=e.y),e.y>t.maxY&&(t.maxY=e.y)},move:function(e,t){var n=e.current.x,r=e.current.y,a=e.current.angle,i=Math.round(n+t*Math.cos(a)),s=Math.round(r+t*Math.sin(a));e.current.x=i,e.current.y=s,e.parent=e.current.index,e.index++,e.current.index=e.index},getValueFromRange:function(e,t){return t?Math.random()*(e[1]-e[0])+e[0]:e},savePoint:function(e,t){var n=e.parent,r=this.copyObject(e.current);r.parent=n,t.set(e.index,r)},saveCurrent:function(e){e.current.level=e.level;var t=this.copyObject(e.current);e.stack.push(t)},restoreCurrent:function(e){e.current=e.stack.pop()},toPositive:function(e){var t=new Map,n=e.minX,r=e.minY,a=r<0,i=n<0;return e.map.forEach((function(e,s){var o=Object.assign({},e);i&&(o.x+=Math.abs(n)),a&&(o.y+=Math.abs(r)),t.set(s,o)})),n+=i?Math.abs(n):0,r+=a?Math.abs(r):0,{map:t,width:e.width,height:e.height}},angleToRadians:function(e){var t=Math.PI/180;return Array.isArray(e)?(e[0]=e[0]*t,e[1]=e[1]*t):e*=t,e},validateLength:function(e){return Array.isArray(e)?(e[0]=e[0]<1?1:e[0],e[1]=e[1]<1?1:e[1]):e=e<1?1:e,e},validateAngle:function(e){return Array.isArray(e)?(e[0]=e[0]<1?1:e[0],e[0]=e[0]>359?359:e[0],e[1]=e[1]<1?1:e[1],e[1]=e[1]>359?359:e[1]):e=(e=e<1?1:e)>359?359:e,this.angleToRadians(e)},maxIterations:function(e,t){var n=(e.match(/X/g)||[]).length,r=(e.match(/F/g)||[]).length,a=Math.round(Math.log(1+(n-1)*n*t/(n*r+n*n))/Math.log(n));return a}}}}]),e}();try{module.exports=LsPointsGenerator}catch(e){}